<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Oh view where art thou | Peter MacNaughton</title><meta name="description" content="Peter MacNaughton's personal website"><meta name="keywords" content="peter, macnaughton, tech, programmming, .net"><meta name="author" content="Peter MacNaughton"><meta name="generator" content="DocPad v6.54.6" /><meta name="viewport" content="width=device-width"><link rel="shortcut icon" href="images/icons/favicon.ico"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/icons/apple-touch-icon-144-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/icons/apple-touch-icon-114-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/icons/apple-touch-icon-72-precomposed.png"><link rel="apple-touch-icon-precomposed" href="images/icons/apple-touch-icon-57-precomposed.png"><!--[if lt IE 9]><script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link  rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" /><link  rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" /><link  rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" /><link  rel="stylesheet" href="/styles/twitter-bootstrap.css" /><link  rel="stylesheet" href="/styles/codehighlight.css" /><link  rel="stylesheet" href="/styles/style.css" /></head><body><div class="navbar navbar-default navbar-fixed-top"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">MacNaughton</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li typeof="sioc:Page" about="/pages/about"><a href="/pages/about" property="dc:title">About</a></li></ul></div></div><div id="wrap"><section id="content" class="content col-xs-12 col-md-9"><article id="post" class="col-xs-12 post col-lg-8 pull-right"><h1>Oh view where art thou</h1><div class="post-content"><p>Iâ€™ve quite recently started playing around with Nancy and was sitting down to write some tests for already existing code. (Yes, I sometimes write code before tests when exploring new frameworks) This code had already seen quite a lot of use and writing the initial tests was going to be easy.<!-- read more --></p>
<p>Sure enough they all started out simple and working as intended one after the other. Making sure that SSL was forced where it was supposed to and that authentication was required for secured resources, etc.</p>
<p>But then I come to finally test something that returns an actual view.</p>
<pre class="highlighted"><code class="cs">    [Fact]
    <span class="keyword">public</span> <span class="keyword">void</span> authorized_user_should_get_index_view()
    {
        <span class="keyword">var</span> identifier = GetIdentifier.ForExistingUser();
        <span class="keyword">var</span> browser = BuildBrowser();
        <span class="keyword">var</span> result = browser.Get(<span class="string">"/"</span>, with =&gt; {
            with.HttpsRequest();
            with.FormsAuth(identifier , fakeAuthenticationConfiguration);
        });
        Assert.Equal(HttpStatusCode.OK, result.StatusCode);
    }</code></pre>
<p>Lo and behold, I have a failing test for code that demonstrably works outside tests. 
Not only is it a failing test but IntelliTrace reveals that there was a <strong>ViewNotFoundException</strong> thrown internally for a view that works when running live.</p>
<p>After some digging I finally realize that I have two different issues going on.</p>
<ul>
<li>I had <strong>not referenced my view engine assembly in my testing assembly</strong>. Nancy.ViewEngines.Razor in this case since I quite like razor. Something you apparently have to do in order to test any of the non-default view engines.</li>
<li><strong>Copy to Output Directory</strong> was set to <strong>Do not copy</strong> for the view in question. Which seems to not be an issue for actually running the site but is if you want to write tests.</li>
</ul>
<p>Adding the reference to the view engine assembly and changing the copy settings to <strong>Copy when newer</strong> or <strong>Copy always</strong> solves the problem and the test passes as expected.</p>
</div></article><aside class="col-xs-12 col-lg-4 pull-right"></aside><section class="col-xs-12 col-lg-8 pull-right"><h1>Comments</h1><div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_shortname = 'macnaughton';
var disqus_identifier = 'http://peter.macnaughton.info/posts/oh-view-where-art-thou';
var disqus_url = 'http://peter.macnaughton.info/posts/oh-view-where-art-thou';
var disqus_title = 'Oh view where art thou';
var disqus_script = 'embed.js';

(function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());</script></section></section><section id="asides" class="container col-xs-12 col-md-3"><aside><h1>Also available on</h1><a href="http://stackoverflow.com/users/1418063/pmacnaughton" target="_blank"><img src="/images/stackoverflow.svg" alt="StackOverflow" title="StackOverflow" class="profile-icon img-thumbnail"/></a><a href="http://careers.stackoverflow.com/pmacnaughton" target="_blank"><img src="/images/careers.svg" alt="StackOverflow Careers" title="StackOverflow Careers" class="profile-icon img-thumbnail"/></a><a href="http://github.com/pmacn" target="_blank"><img src="/images/github.svg" alt="GitHub" title="GitHub" class="profile-icon img-thumbnail"/></a><a href="http://www.linkedin.com/in/pmacnaughton" target="_blank"><img src="/images/linkedin.svg" alt="LinkedIn" title="LinkedIn" class="profile-icon img-thumbnail"/></a></aside></section></div><div class="clearfix"></div><footer id="sitefooter" class="text-muted"><p class="pull-left">Content is &copy; Peter MacNaughton 2013</p><p class="pull-right">This website was last updated on Thu Nov 14 2013</p></footer><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap/dist/js/bootstrap.min.js"></script><script defer="defer"  src="/scripts/script.js"></script><script defer="defer"  src="/scripts/google-analytics.js"></script></body></html>